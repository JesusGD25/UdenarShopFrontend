<div class="checkout-overlay">
  <div class="checkout-modal">
    <div class="checkout-header">
      <h2>üí≥ Pasarela de Pago</h2>
      <button class="close-btn" (click)="onCancel()" [disabled]="isProcessing">‚úï</button>
    </div>

    <div class="checkout-content">
      <!-- Resumen del pedido -->
      <div class="order-summary">
        <h3>Resumen del Pedido</h3>
        <div class="summary-items">
          <div class="summary-item" *ngFor="let item of cartItems">
            <span>{{item.product.title}} (x{{item.quantity}})</span>
            <span>${{getItemSubtotal(item) | number:'1.0-0'}}</span>
          </div>
        </div>
        <div class="summary-total">
          <strong>Total a pagar:</strong>
          <strong class="total-amount">${{total | number:'1.0-0'}}</strong>
        </div>
      </div>

      <!-- Formulario de pago -->
      <form class="payment-form" (ngSubmit)="onSubmit()">
        <h3>Informaci√≥n de Pago</h3>
        
        <div class="form-group">
          <label for="cardNumber">N√∫mero de Tarjeta *</label>
          <input 
            type="text" 
            id="cardNumber" 
            [(ngModel)]="paymentData.cardNumber"
            name="cardNumber"
            (input)="formatCardNumber($event)"
            placeholder="1234 5678 9012 3456"
            maxlength="16"
            required
            [disabled]="isProcessing"
          >
        </div>

        <div class="form-group">
          <label for="cardHolder">Nombre del Titular *</label>
          <input 
            type="text" 
            id="cardHolder" 
            [(ngModel)]="paymentData.cardHolder"
            name="cardHolder"
            placeholder="JUAN P√âREZ"
            required
            [disabled]="isProcessing"
          >
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="expiryDate">Fecha de Expiraci√≥n *</label>
            <input 
              type="text" 
              id="expiryDate" 
              [(ngModel)]="paymentData.expiryDate"
              name="expiryDate"
              (input)="formatExpiryDate($event)"
              placeholder="MM/YY"
              maxlength="5"
              required
              [disabled]="isProcessing"
            >
          </div>

          <div class="form-group">
            <label for="cvv">CVV *</label>
            <input 
              type="text" 
              id="cvv" 
              [(ngModel)]="paymentData.cvv"
              name="cvv"
              (input)="formatCVV($event)"
              placeholder="123"
              maxlength="4"
              required
              [disabled]="isProcessing"
            >
          </div>
        </div>

        <h3>Informaci√≥n de Env√≠o</h3>

        <div class="form-group">
          <label for="email">Email *</label>
          <input 
            type="email" 
            id="email" 
            [(ngModel)]="paymentData.email"
            name="email"
            placeholder="correo@ejemplo.com"
            required
            [disabled]="isProcessing"
          >
        </div>

        <div class="form-group">
          <label for="address">Direcci√≥n *</label>
          <input 
            type="text" 
            id="address" 
            [(ngModel)]="paymentData.address"
            name="address"
            placeholder="Calle Principal #123"
            required
            [disabled]="isProcessing"
          >
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="city">Ciudad *</label>
            <input 
              type="text" 
              id="city" 
              [(ngModel)]="paymentData.city"
              name="city"
              placeholder="Pasto"
              required
              [disabled]="isProcessing"
            >
          </div>

          <div class="form-group">
            <label for="postalCode">C√≥digo Postal</label>
            <input 
              type="text" 
              id="postalCode" 
              [(ngModel)]="paymentData.postalCode"
              name="postalCode"
              placeholder="520001"
              [disabled]="isProcessing"
            >
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Notas adicionales (Opcional)</label>
          <textarea
            id="notes"
            [(ngModel)]="paymentData.notes"
            name="notes"
            placeholder="Ej: Por favor, llamar antes de entregar"
            rows="3"
            [disabled]="isProcessing"
          ></textarea>
        </div>

        <div class="error-message" *ngIf="errorMessage">
          ‚ö†Ô∏è {{errorMessage}}
        </div>

        <div class="form-actions">
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="onCancel()"
            [disabled]="isProcessing"
          >
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-pay"
            [disabled]="isProcessing"
          >
            <span *ngIf="!isProcessing">üîí Pagar ${{total | number:'1.0-0'}}</span>
            <span *ngIf="isProcessing">Procesando...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
