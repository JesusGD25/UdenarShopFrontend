<div class="checkout-container">
  <div class="checkout-content">
    <div class="checkout-header">
      <h2>Finalizar Compra</h2>
      <button class="close-btn" (click)="onCancel()" [disabled]="isProcessing">✕</button>
    </div>

    <div class="order-summary">
      <h3>Resumen del Pedido</h3>
      <div class="cart-items">
        <div *ngFor="let item of cartItems" class="cart-item">
          <span class="item-name">{{ item.product.title }}</span>
          <span class="item-quantity">x{{ item.quantity }}</span>
          <span class="item-price">${{ getItemSubtotal(item) | number:'1.0-0' }}</span>
        </div>
      </div>
      <div class="total">
        <span>Total:</span>
        <span>${{ total | number:'1.0-0' }}</span>
      </div>
    </div>

    <form (ngSubmit)="onSubmit()" class="payment-form">
      <div class="form-section">
        <h3>Información de Pago</h3>
        
        <div class="form-group">
          <label>Número de Tarjeta</label>
          <input 
            type="text" 
            [(ngModel)]="paymentData.cardNumber"
            name="cardNumber"
            (input)="formatCardNumber($event)"
            placeholder="1234 5678 9012 3456"
            maxlength="16"
            required
            [disabled]="isProcessing">
        </div>

        <div class="form-group">
          <label>Nombre del Titular</label>
          <input 
            type="text" 
            [(ngModel)]="paymentData.cardHolder"
            name="cardHolder"
            placeholder="Nombre como aparece en la tarjeta"
            required
            [disabled]="isProcessing">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Fecha de Expiración</label>
            <input 
              type="text" 
              [(ngModel)]="paymentData.expiryDate"
              name="expiryDate"
              (input)="formatExpiryDate($event)"
              placeholder="MM/YY"
              maxlength="5"
              required
              [disabled]="isProcessing">
          </div>

          <div class="form-group">
            <label>CVV</label>
            <input 
              type="text" 
              [(ngModel)]="paymentData.cvv"
              name="cvv"
              (input)="formatCVV($event)"
              placeholder="123"
              maxlength="4"
              required
              [disabled]="isProcessing">
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Información de Envío</h3>
        
        <div class="form-group">
          <label>Email</label>
          <input 
            type="email" 
            [(ngModel)]="paymentData.email"
            name="email"
            placeholder="tu@email.com"
            required
            [disabled]="isProcessing">
        </div>

        <div class="form-group">
          <label>Dirección</label>
          <input 
            type="text" 
            [(ngModel)]="paymentData.address"
            name="address"
            placeholder="Calle, número, apartamento"
            required
            [disabled]="isProcessing">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Ciudad</label>
            <input 
              type="text" 
              [(ngModel)]="paymentData.city"
              name="city"
              placeholder="Ciudad"
              required
              [disabled]="isProcessing">
          </div>

          <div class="form-group">
            <label>Código Postal</label>
            <input 
              type="text" 
              [(ngModel)]="paymentData.postalCode"
              name="postalCode"
              placeholder="12345"
              [disabled]="isProcessing">
          </div>
        </div>

        <div class="form-group">
          <label>Notas (Opcional)</label>
          <textarea 
            [(ngModel)]="paymentData.notes"
            name="notes"
            placeholder="Instrucciones especiales para la entrega"
            rows="3"
            [disabled]="isProcessing"></textarea>
        </div>
      </div>

      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="onCancel()" [disabled]="isProcessing">
          Cancelar
        </button>
        <button type="submit" class="btn-submit" [disabled]="isProcessing">
          {{ isProcessing ? 'Procesando...' : 'Confirmar Pago' }}
        </button>
      </div>
    </form>
  </div>
</div>
